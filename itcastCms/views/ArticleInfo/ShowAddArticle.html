<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加文章</title>
    <script src="/static/js/jquery.js" type="text/javascript"></script>
    <script src="/static/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="/static/js/MyAjaxForm.js" type="text/javascript"></script>
    <script src="/static/js/Ckeditor/ckeditor.js"></script>
    <link href="/static/css/tableStyle.css" rel="stylesheet" />
    <style type="text/css">
        textarea, select {
            padding: 2px;
            border: 1px solid;
            border-color: #666 #ccc #ccc #666;
            background: #F9F9F9;
            color: #333;
            resize: none;
            width: 100%;
        }

        .textbox {
            padding: 3px;
            border: 1px solid;
            border-color: #666 #ccc #ccc #666;
            background: #F9F9F9;
            color: #333;
            resize: none;
            width: 100%;
        }

        .textbox:hover, .textbox:focus, textarea:hover, textarea:focus {
            border-color: #09C;
            background: #F5F9FD;
        }
    </style>
    <script type="text/javascript">
        $(function () {
            //绑定文本框失去焦点事件
           /* CKEDITOR.instances["ArticleContent2"].on("blur",function () {
                var editor=CKEDITOR.instances.ArticleContent2;
                $("#txtArticleContent").val(editor.getData());//获取编辑器中的内容,并且完成赋值
                $("#form1").submit();
            })*/
            bindBtnFileUp();
        })
        function bindBtnFileUp() {
            //实现文件的异步上传
            //绑定按钮的单击事件
            $('#btnFileUp').click(function () {
                $('#form1').ajaxSubmit({
                    success:function (data){
                        if (data.flag == "ok"){
                            //上传成功后，进行路径的返回
                            var src = data.msg.substr(1)
                            //先展示图片的包裹内写入图片的信息，进行图片的展示
                            $('#showImage').html("<img src='"+src+"' width='50px' height='50px'>")
                            //将文件的路径传递给图标的隐藏域
                            $('#PhotoUrl').val(src)
                            //先判断一下上传图片复选框是否被选中
                            var b= $('#InsertEditContent').is(":checked")//被选中为true
                            if (b){
                                var oEditor = CKEDITOR.instances.ArticleContent2;
                                if (oEditor.mode == 'wysiwyg') {//表示在可视化的模式（所见即所得）下插入
                                    var imgsrc="<img src='"+src+"'>";
                                    oEditor.insertHtml( imgsrc );//将图片插入到编辑器中
                                    //失去焦点。

                                }else{
                                    alert( 'You must be in WYSIWYG mode!' );
                                }

                            }
                        }else{

                        }
                    },
                    error:function (error) {
                        alert(error);
                    },
                    url:'/Admin/ArticleInfo/FileUp', //设置文件的上传路径
                    type:"post",//设置表单的提交方式
                    dataType:"json"//设置数据的返回值类型参数
                })
            })
        }
        //提交表单了
        function SubForm() {
            var editor=CKEDITOR.instances.ArticleContent2;
            $("#txtArticleContent").val(editor.getData());//获取编辑器中的内容,并且完成赋值
            $("#form1").submit();
        }

    </script>
</head>
<body>
<div>
    <form  data-ajax="true" data-ajax-method="post" data-ajax-success="afterAdd" data-ajax-url="/Admin/ArticleInfo/AddArticle" id="form1">
        <table style="width:auto; margin: 0 auto">
            <tr>
                <td>简短标题:</td>

                <td>
                    <input type="text" name="title" maxlength="160" class="textbox" id="title" /></td>


            </tr>
            <tr>
                <td>完整标题:</td>
                <td colspan="4">
                    <input type="text" name="Fulltitle" class="textbox" id="Fulltitle" /></td>
            </tr>
            <tr>
                <td>归属栏目:</td>
                <td colspan="4">
                {{range .classInfo}}
                    <input type="radio" value="{{.Id}}" name="classId">{{.ClassName}}
                {{end}}
                </td>
            </tr>
            <tr>
                <td>关 键 字</td>
                <td colspan="4">
                    <input type="text" name="KeyWords" class="textbox" id="KeyWords" /></td>
            </tr>
            <tr>
                <td>文章作者:</td>
                <td colspan="4">
                    <input type="text" name="Author" class="textbox" id="Author" />&nbsp;&nbsp;【<a href="#" class="authorClick">未知</a>】【<a href="#" class="authorClick">佚名</a>】【<a href="#" class="authorClick">Itcast</a>】</td>
            </tr>
            <tr>
                <td>文章来源:</td>
                <td colspan="4">
                    <input name="Origin" id="Origin"  value="" size="50" class="textbox" type="text">&nbsp;&nbsp;【<a href="#" class="originInfo">不详</a>】【<a href="#" class="originInfo">本站原创</a>】【<a href="#" class="originInfo">互联网</a>】</td>
            </tr>
            <tr>
                <td>文章导读</td>
                <td colspan="4">
                    <textarea class="textbox" name="Intro" style="width: 95%; height: 80px"></textarea></td>
            </tr>
            <tr>
                <td>文章内容</td>
                <td colspan="4">
                    <textarea class="ckeditor" onblur="getData2()" id="ArticleContent2" name="ArticleContent1" rows="30" cols="40" style="width: 95%; height: 80px"></textarea>
                    <script type="text/javascript">
                        //<![CDATA[
                        // Replace the <textarea id="editor1"> with an CKEditor instance.

                        var editor = CKEDITOR.replace('ArticleContent2');


                        //]]>
                    </script>
                    <textarea class="textbox"  name="ArticleContent" id="txtArticleContent" rows="30" cols="40" style="display:none"></textarea>
                </td>
            </tr>
            <tr>
                <td>图片地址:</td>
                <td colspan="4">
                    <input type="file" name="fileUp" />
                    <input type="button" value="上传图片" id="btnFileUp" />
                    <div id="showImage" ></div>


                    <input name="PhotoUrl" id="PhotoUrl" value="" type="hidden">

                    <input name="InsertEditContent" id="InsertEditContent" value="1" type="checkbox">图片是否插入编辑器
                </td>
            </tr>
        </table>
    </form>
</div>
</div>

</body>
</html>